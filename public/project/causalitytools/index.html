<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.3.1">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Bjarte Hannisdal">

  
  
  
    
  
  <meta name="description" content="A Julia package for computing causal estimators from time series data.">

  
  <link rel="alternate" hreflang="en-us" href="https://www.earthsystemevolution.com/project/causalitytools/">

  


  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.223b6f101b4ce491745cff2a9f62baa7.css">

  

  
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://www.earthsystemevolution.com/project/causalitytools/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Earth System Evolution">
  <meta property="og:url" content="https://www.earthsystemevolution.com/project/causalitytools/">
  <meta property="og:title" content="Causality Tools | Earth System Evolution">
  <meta property="og:description" content="A Julia package for computing causal estimators from time series data."><meta property="og:image" content="https://www.earthsystemevolution.com/project/causalitytools/featured.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-11-11T00:00:00&#43;01:00">
  
  <meta property="article:modified_time" content="2019-11-11T00:00:00&#43;01:00">
  

  

  

  <title>Causality Tools | Earth System Evolution</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" class="dark">
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Earth System Evolution</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#demo">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#tools">
            
            <span>Tools</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks">
            
            <span>Talks</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#people">
            
            <span>People</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#funding">
            
            <span></span>
            
          </a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


<article class="article article-project" itemscope itemtype="http://schema.org/Article">

  













<div class="article-header d-xl-none">
  <div class="featured-image" style="background-image: url('/project/causalitytools/featured_hu4e1387161fa564bf97cd806d158b643b_335857_800x0_resize_lanczos_2.png');"></div>
  
</div>


<div class="container-fluid split-header d-none d-xl-block">
  <div class="row">
    <div class="col-6">
      <div class="split-header-content">
        <h1 itemprop="name">Causality Tools</h1>

        

        



<meta content="2019-11-11 00:00:00 &#43;0100 CET" itemprop="datePublished">
<meta content="2019-11-11 00:00:00 &#43;0100 CET" itemprop="dateModified">

<div class="article-metadata">

  
  
  
  
  <div>
    



  <span itemprop="author name" itemtype="http://schema.org/Person"><a href="/authors/kristian-a.-haaga/">Kristian A. Haaga</a></span>, <span itemprop="author name" itemtype="http://schema.org/Person"><a href="/authors/david-diego/">David Diego</a></span>, <span itemprop="author name" itemtype="http://schema.org/Person">Tor Einar MÃ¸ller</span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    <time>Nov 11, 2019</time>
  </span>
  

  

  

  
  

  
  

  

</div>


        













<div class="btn-links mb-3">
  
  








  









  
  <a class="btn btn-outline-primary my-1 mr-1" href="/project/causalitytools/">
    Project
  </a>
  











</div>



        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Causality%20Tools&amp;url=https%3a%2f%2fwww.earthsystemevolution.com%2fproject%2fcausalitytools%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.earthsystemevolution.com%2fproject%2fcausalitytools%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.earthsystemevolution.com%2fproject%2fcausalitytools%2f&amp;title=Causality%20Tools"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fwww.earthsystemevolution.com%2fproject%2fcausalitytools%2f&amp;title=Causality%20Tools"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Causality%20Tools&amp;body=https%3a%2f%2fwww.earthsystemevolution.com%2fproject%2fcausalitytools%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
    </div>
    <div class="col-6">
      <div class="split-header-image">
        <img src="/project/causalitytools/featured_hu4e1387161fa564bf97cd806d158b643b_335857_680x500_fill_q90_lanczos_smart1_2.png" itemprop="image" alt="">
        
      </div>
    </div>
  </div>
</div>

<div class="article-container d-xl-none">
  <h1 itemprop="name">Causality Tools</h1>

  

  



<meta content="2019-11-11 00:00:00 &#43;0100 CET" itemprop="datePublished">
<meta content="2019-11-11 00:00:00 &#43;0100 CET" itemprop="dateModified">

<div class="article-metadata">

  
  
  
  
  <div>
    



  <span itemprop="author name" itemtype="http://schema.org/Person"><a href="/authors/kristian-a.-haaga/">Kristian A. Haaga</a></span>, <span itemprop="author name" itemtype="http://schema.org/Person"><a href="/authors/david-diego/">David Diego</a></span>, <span itemprop="author name" itemtype="http://schema.org/Person">Tor Einar MÃ¸ller</span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    <time>Nov 11, 2019</time>
  </span>
  

  

  

  
  

  
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=&amp;url="
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u="
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=&amp;title="
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=&amp;title="
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=&amp;body=">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

  













<div class="btn-links mb-3">
  
  








  









  
  <a class="btn btn-outline-primary my-1 mr-1" href="/project/causalitytools/">
    Project
  </a>
  











</div>


</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      

<p><a href="https://github.com/JuliaDynamics/CausalityTools.jl" target="_blank">CausalityTools.jl</a> provides a collection of algorithms for the detection of underlying causal structure from time series data, and for the approximation of the transfer operator and invariant measures. It is part of the <a href="https://juliadynamics.github.io/JuliaDynamics/" target="_blank">JuliaDynamics</a> organization.</p>

<p>The package is equally well-suited both for the study of causal directionality
from empirical data and for studying theoretical systems. Key features include:</p>

<ul>
<li><p>Integration with <a href="https://github.com/kahaaga/UncertainData.jl" target="_blank">UncertainData.jl</a>, which makes
<a href="https://juliadynamics.github.io/CausalityTools.jl/dev/causalitytests/causality_from_uncertain_data_naive/" target="_blank">handling uncertainties</a> in your causality analyses a breeze.</p></li>

<li><p>Integration with <a href="https://github.com/JuliaDynamics/DynamicalSystems.jl" target="_blank">DynamicalSystems.jl</a>,
which allows the causality statistics to be
<a href="https://juliadynamics.github.io/CausalityTools.jl/dev/causalitytests/causality_from_dynamical_systems/" target="_blank">applied to dynamical systems</a>.</p></li>

<li><p><a href="https://juliadynamics.github.io/CausalityTools.jl/dev/example_systems/example_systems_overview/" target="_blank">Library of coupled dynamical systems</a>
for testing algorithm performance.</p></li>
</ul>

<p>For more information, see the package <a href="https://juliadynamics.github.io/CausalityTools.jl/dev/" target="_blank">documentation</a>.</p>

<h1 id="a-brief-tutorial">A brief tutorial</h1>

<p>Here&rsquo;s an example of how to use some of the functionality in the <code>CausalityTools.jl</code> package.  The <code>jupyter</code> notebook was run with a Julia 1.2 kernel (<em>Note</em>: Pending a 1.0 release, there may be breaking changes).</p>

<pre><code class="language-julia">using CausalityTools
using DynamicalSystemsBase
using Distributions
using Measures
using LaTeXStrings
using Plots; pyplot()
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
Plots.PyPlotBackend()
</span></p>

<h3 id="defining-a-dynamical-system-and-generating-time-series">Defining a dynamical system and generating time series</h3>

<p>Let&rsquo;s define a system composed of two unidirectionally coupled logistic maps:</p>

<pre><code class="language-julia">function eom_logistic2(dx, x, p, n)
    c_xy, râ, râ, Ï = (p...,)
    Î¾ = rand()
    x, y = x[1], x[2]
    f_xy = (y +  (c_xy*(x + Ï*Î¾)/2) ) / (1 + (c_xy/2)*(1+Ï))

    dx[1] = râ * x * (1 - x)
    dx[2] = râ * (f_xy) * (1 - f_xy)
    return
end
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
eom_logistic2 (generic function with 1 method)
</span></p>

<p>Create a function that returns an instance of a <code>DynamicalSystems.DiscreteDynamicalSystem</code>.</p>

<pre><code class="language-julia">function logistic2(uâ, c_xy, râ, râ, Ï)
    p = [c_xy, râ, râ, Ï]
    DiscreteDynamicalSystem(eom_logistic2_unidir, uâ, p)
end

logistic2(;uâ = rand(2), c_xy = 0.1, râ = 3.78, râ = 3.66, Ï = 0.05) =
    logistic2(uâ, c_xy, râ, râ, Ï)
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
logistic2 (generic function with 2 methods)
</span></p>

<p>Initialise a system</p>

<pre><code class="language-julia">system = logistic2(c_xy = 0.5, râ = 3.7, râ = 3.8)
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
2-dimensional discrete dynamical system</br>
 state:       [0.422895, 0.736883]</br>
 e.o.m.:      eom_logistic2_unidir</br>
 in-place?    true</br>
 jacobian:    ForwardDiff</br>
 parameters:  [0.5, 3.7, 3.8, 0.05]
</span></p>

<p>Generate orbit (time series).</p>

<pre><code class="language-julia">npts = 300
orbit = trajectory(system, 300, Ttr = 1000)
x, y = columns(orbit);
</code></pre>

<p>Plot it</p>

<pre><code class="language-julia">plot(size = (700, 400), bottom_margin = 5mm, left_margin = 5mm,
    tickfont = font(12), guidefont = font(12), legendfont = font(12),
    xlabel = &quot;Time&quot;, ylabel = &quot;Value&quot;, legend = :topleft)
plot!(0:npts, x, c = :black, label = &quot;x&quot;, lw = .5)
plot!(0:npts, y, c = :red, label = &quot;y&quot;, lw = .5)
</code></pre>

<p><img src="./CausalityTools_tutorial_PredictiveAsymmetryTest_12_0.png" alt="png" /></p>

<p>Okay, so we have some time series</p>

<h2 id="predictiveasymmetrytest">PredictiveAsymmetryTest</h2>

<p>In this example, we will use a new test for causality from time series. Let&rsquo;s first investigate the documentation for the test:</p>

<pre><code class="language-julia">?PredictiveAsymmetryTest
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
 search: <strong>PredictiveAsymmetryTest predictive_asymmetry</strong>
</span></p>

<p><code>PredictiveAsymmetryTest(predictive_test::CausalityTest)</code></p>

<p>The parameters for a predictive asymmetry causality test [1].</p>

<h2 id="mandatory-keywords">Mandatory keywords</h2>

<ul>
<li><strong><code>predictive_test</code></strong>: An instance of a predictive causality test that explicitly    uses prediction lags (e.g. <code>VisitationFrequencyTest</code> or  <code>TransferOperatorGridTest</code>.</li>
</ul>

<h2 id="about-the-prediction-lags">About the prediction lags</h2>

<p>The prediction lags in the predictive causality test must consist of <code>n</code> negative  integers and <code>n</code> positive integers that are symmetric around zero.</p>

<p>In other words, negative lags  must exactly match the positive lags but with opposite  sign. The zero lag can be included, but will be ignored, so it is possible to give  ranges too.</p>

<h2 id="examples">Examples</h2>

<pre><code class="language-julia">test_visitfreq = VisitationFrequencyTest(Î·s = [-5, -4, -2, -1, 0, 1, 2, 4, 5])
test_transferoperator = TransferOperatorGridTest(Î·s = -3:3)

# Note that `predictive_test` is a *mandatory* keyword.
PredictiveAsymmetryTest(predictive_test = test_visitfreq)
PredictiveAsymmetryTest(predictive_test = test_transferoperator)
</code></pre>

<h2 id="a-transfer-entropy-test">A Transfer entropy test</h2>

<p>Okay, so we first need to define a transfer entropy test to use for the prediction. For this, we have several choices, but for the demonstration, we&rsquo;ll stick to the <code>TransferOperatorGridTest</code>, which estimates probabilities from an approximation to the transfer operator <a href="https://www.earthsystemevolution.com/publication/diego_et_al_2019/" target="_blank">Diego et al., 2019</a>.</p>

<pre><code class="language-julia">?TransferOperatorGridTest
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
 search:<strong>TransferOperatorGridTest TransferOperatorGrid</strong>
</span></p>

<p><code>TransferOperatorGridTest(k::Int = 1, l::Int = 1, m::Int = 1, n::Int = 1,
    Ï::Int = 1, b = 2, estimator::TransferOperatorGrid = TransferOperatorGrid(),
    binning_summary_statistic::Function = StatsBase.mean,
    binning::RectangularBinning, Î·s)</code></p>

<p>The parameters for a transfer entropy test using the <code>TransferOperatorGrid</code> estimator.</p>

<h2 id="mandatory-keyword-arguments">Mandatory keyword arguments</h2>

<ul>
<li><strong><code>binning::RectangularBinning</code></strong>: An instance of a <code>RectangularBinning</code> that dictates    how the delay embedding is discretized.</li>
<li><strong><code>Î·s</code></strong>: The prediction lags (that gos into the $T_{f}$ component of the embedding).</li>
</ul>

<h2 id="optional-keyword-arguments">Optional keyword arguments</h2>

<ul>
<li><strong><code>k::Int</code></strong>: The dimension of the $T_{f}$ component of the embedding.</li>
<li><strong><code>l::Int</code></strong>: The dimension of the $T_{pp}$ component of the embedding.</li>
<li><strong><code>m::Int</code></strong>: The dimension of the $S_{pp}$ component of the embedding.</li>
<li><strong><code>n::Int</code></strong>: The dimension of the $C_{pp}$ component of the embedding.</li>
<li><strong><code>Ï::Int</code></strong>: The embedding lag. Default is <code>Ï = 1</code>.</li>
<li><strong><code>b</code></strong>: Base of the logarithm. The default (<code>b = 2</code>) gives the TE in bits.</li>
<li><strong><code>estimator::TransferOperatorGrid</code></strong>: A <code>TransferOperatorGrid</code> estimator instance.</li>
<li><strong><code>binning_summary_statistic::Function</code></strong>: A summary statistic to summarise the    transfer entropy values if multiple binnings are provided.</li>
</ul>

<h2 id="estimation-of-the-invariant-measure">Estimation of the invariant measure</h2>

<p>With a <code>TransferOperatorGridTest</code>, the first step is to compute an approximation to the transfer operator over the partition elements of a rectangular discretization of an appropriate delay reconstruction of the time  series to be analysed. Transfer entropy is then computed from the invariant  distribution arising from the transfer operator.</p>

<h2 id="about-the-delay-reconstruction-for-transfer-entropy-analysis">About the delay reconstruction for transfer entropy analysis</h2>

<p>Denote the time series for the source process $S$ as $S(t)$, and the time series for  the target process $T$ as $T(t)$, and $C_i(t)$ as the time series for any conditional  processes $C_i$ that also may influence $T$. To compute (conditional) TE, we need a  generalised embedding incorporating all of these processes.</p>

<p>For convenience, define the state vectors</p>

<p>$$
\begin{align}
T_f^{(k)} &amp;= {(T(t+\eta_k), \ldots, T(t+\eta_2), T(t+\eta_1))}, \newline
T_{pp}^{(l)} &amp;= { (T(t), T(t-\tau_1), T(t-\tau_2), \ldots, T(t - \tau_{l - 1}))}, \newline
S_{pp}^{(m)} &amp;= {(S(t), S(t-\tau_1), S(t-\tau_2), \ldots, S(t-\tau_{m - 1}))},\newline
C_{pp}^{(n)} &amp;= { (C_1(t), C_1(t-\tau_1), \ldots,  C_2(t), C_2(t-\tau_1) },
\end{align}
$$</p>

<p>where the state vectors $T_f^{(k)}$ contain $k$ future values of the target  variable, $T_{pp}^{(l)}$ contain $l$ present and past values of the target  variable, $S_{pp}^{(m)}$ contain $m$ present and past values of the source  variable, $C_{pp}^{(n)}$ contain a total of $n$ present and past values of any  conditional variable(s).  Combining all variables, we have the generalised embedding</p>

<p>$$
\begin{align}
\mathbb{E} = (T_f^{(k)}, T_{pp}^{(l)}, S_{pp}^{(m)}, C_{pp}^{(n)})
\end{align}
$$</p>

<p>with a total embedding dimension of $k + l + m + n$.  Here, $\tau$ indicates the embedding lag  (in the <code>VisitationFrequencyTest</code>, we set $\tau_1 = \tau_2 = \tau_3 = \ldots$), and $\eta$ indicates the prediction lag (the lag of the influence the source  has on the target).</p>

<p>Hence, in the generalised embedding, only $T_f$ depends on the prediction lag $\eta$,  which is to be determined by the analyst. For transfer entropy analysis, $\eta$ is chosen  to be some positive integer, while for predictive asymmetry analysis,  symmetric negative and positive $\eta$s are used for computing $\mathbb{A}$.</p>

<p>In terms of this generalised embedding, transfer entropy from a source variable $S$ to a  target variable $T$ with conditioning on variable(s) $C$ is thus defined as</p>

<p>$$
\begin{align}
TE_{S \rightarrow T|C} = \int_{\mathbb{E}} P(T_f, T_{pp}, S_{pp}, C_{pp}) \log_{2}{\left( \frac{P(T_f | T_{pp}, S_{pp}, C_{pp})}{P(T_f | T_{pp}, C_{pp})}\right)}
\end{align}
$$</p>

<p>Without conditioning, we have</p>

<p>$$
\begin{align}
TE_{S \rightarrow T} = \int_{\mathbb{E}} P(T_f, T_{pp}, S_{pp}) \log_{2}{\left(\frac{P(T_f | T_{pp}, S_{pp})}{P(T_f | T_{pp})}\right)}
\end{align}
$$</p>

<h2 id="low-level-estimator">Low-level estimator</h2>

<p>This test uses the <code>TransferOperatorGrid</code> estimator on the following low-level method  under the hood.</p>

<ul>
<li><code>transferentropy(::Any, ::TEVars, ::RectangularBinning, ::TransferEntropyEstimator)</code></li>
</ul>

<p>In this estimator, the mapping between variables of the generalised embedding and the marginals during  transfer entropy computation is controlled using a <code>TEVars</code>  instance. It is <em>highly</em> recommended that you check the documentation for this  method, because it describes the transfer entropy estimation procedure in detail.</p>

<h2 id="notes">Notes:</h2>

<ul>
<li>Use <code>causality(source, target, params::TransferOperatorGridTest)</code> for regular  transfer entropy analysis. This method uses only the <code>k</code>, <code>l</code>, <code>m</code> and ignores <code>n</code>    when constructing the delay reconstruction.</li>
<li>Use <code>causality(source, target, cond, params::TransferOperatorGridTest)</code> for conditional    transfer entropy analysis. This method uses the <code>k</code>, <code>l</code>, <code>m</code> <em>and</em> <code>n</code> when constructing    the delay reconstruction.</li>
</ul>

<h2 id="example">Example</h2>

<pre><code class="language-julia"># Prediction lags
Î·s = 1:10
binning = RectangularBinning(10)

# Use defaults, binning and prediction lags are required.
# Note that `binning` and `Î·s` are *mandatory* keyword arguments.
TransferOperatorGridTest(binning = binning, Î·s = Î·s)

# The other keywords can also be adjusted
TransferOperatorGridTest(k = 1, l = 2, binning = binning, Î·s = Î·s)
</code></pre>

<hr />

<p>Now we have the information we need, and can get back to our example:</p>

<h4 id="define-test">Define test</h4>

<pre><code class="language-julia"># Maximum prediction
Î·_max = 8

# Embedding parameters (3-dimensional embedding)
k, l, m = 1, 1, 1

# Partition
n_subdivisions = floor(Int, npts^(1/(k + l + m + 1)))
bin_scheme = RectangularBinning(n_subdivisions)

#Transfer entropy test with base-2 logarithm,
te_test = TransferOperatorGridTest(binning = bin_scheme,
    Î·s = -Î·_max:Î·_max, b = 2, k = k, l = l, m = m)

# Predictive asymmetry test based on the transfer entropy test
test = PredictiveAsymmetryTest(predictive_test = te_test)
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
PredictiveAsymmetryTest{TransferOperatorGridTest}(predictive_test = TransferOperatorGridTest(k = 1, l = 1, m = 1, n = 1, Ï = 1, b = 2, estimator = TransferOperatorGrid(), binning_summary_statistic = mean, binning = RectangularBinning(4), Î·s = -8:8))
</span></p>

<h4 id="apply-test-to-time-series">Apply test to time series</h4>

<pre><code class="language-julia">influence_xtoy = causality(x, y, test)
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
8-element Array{Float64,1}:<br>
 0.07353044320389923<br>
 0.2048533816659921<br>
 0.3420588893868155<br>
 0.5687136636138481<br>
 0.6351432545620197<br>
 0.7562916061278022<br>
 0.7939027156800291<br>
 0.7966558227653682
</span></p>

<pre><code class="language-julia">influence_ytox = causality(y, x, test)
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
8-element Array{Float64,1}:<br>
 -0.03844661921591097<br>
 -0.11252642048669959<br>
 -0.20612641064467407<br>
 -0.32656831712281686<br>
 -0.3982976779871139<br>
 -0.4919700965986813<br>
 -0.535133253437186<br>
 -0.6047774983739265
</span></p>

<p>Plot the predictive asymmetries against the prediction lags.</p>

<pre><code class="language-julia">plot(size = (600, 300), bottom_margin = 5mm, left_margin = 5mm,
    tickfont = font(12), guidefont = font(12), legendfont = font(12),
    xlabel = &quot;Prediction lag&quot;, ylabel = L&quot;\mathbb{A} (bits)&quot;,
    legend = :topleft)
plot!(1:Î·_max, influence_xtoy, m = :circle, c = :black, label = L&quot;x \to y&quot;)
plot!(1:Î·_max, influence_ytox,  m = :circle, c = :red, label = L&quot;y \to x&quot;)
hline!([0], ls = :dash, lc = :grey, label = &quot;&quot;)
</code></pre>

<p><img src="./CausalityTools_tutorial_PredictiveAsymmetryTest_27_0.png" alt="png" /></p>

<p>We find that the predictive asymmetry in the causal direction ($\mathbb{A}_{x \to y}$) is positive, whereas the asymmetry in the non-causal direction ($\mathbb{A}_{y \to x}$) is negative. We thus recover the <em>unidirectional</em> causal relationship $x \to y$.</p>

<h3 id="an-example-of-bi-directional-coupling">An example of bi-directional coupling</h3>

<p>But can we also detect if the causal influence goes both ways? To illustrate this, let&rsquo;s define a system of two bi-directionally coupled logistic maps:</p>

<pre><code class="language-julia">function eom_logistic2_bidir(dx, x, p, n)

    # c_xy is the coupling from x to y
    # c_yx is the coupling from y to x
    # Ï_yx is the dynamical noise from y to x
    # Ï_xy is the dynamical noise from y to x
    c_xy, c_yx, râ, râ, Ï_xy, Ï_yx = (p...,)

    Î¾â = rand() # random number from flat distribution on [0, 1]
    Î¾â = rand() # random number from flat distribution on [0, 1]
    x, y = x[1], x[2]

    f_xy = (y +  c_xy*(x + Ï_xy*Î¾â) ) / (1 + c_xy*(1+Ï_xy))
    f_yx = (x +  c_yx*(y + Ï_yx*Î¾â) ) / (1 + c_yx*(1+Ï_yx))

    dx[1] = râ * (f_yx) * (1 - f_yx)
    dx[2] = râ * (f_xy) * (1 - f_xy)
    return
end

function logistic2_bidir(uâ, c_xy, c_yx, râ, râ, Ï_xy, Ï_yx)
    p = [c_xy, c_yx, râ, râ, Ï_xy, Ï_yx]
    DiscreteDynamicalSystem(eom_logistic2_bidir, uâ, p)
end

logistic2_bidir(;uâ = rand(2), c_xy = 0.1, c_yx = 0.1,
    râ = 3.78, râ = 3.66, Ï_xy = 0.05, Ï_yx = 0.05) =
    logistic2_bidir(uâ, c_xy, c_yx, râ, râ, Ï_xy, Ï_yx)
</code></pre>

<p><span style="font-family:Courier New; font-size:.75em;">
logistic2_bidir (generic function with 2 methods)
</span></p>

<pre><code class="language-julia"># realize the system with coupling x -&gt; y stronger than coupling y -&gt; x
system = logistic2_bidir(c_xy = 0.5, c_yx = 0.2)
npts = 300
orbit = trajectory(system, 300, Ttr = 1000)
x, y = columns(orbit);
</code></pre>

<pre><code class="language-julia">influence_xtoy = causality(x, y, test)
influence_ytox = causality(y, x, test)

plot(size = (600, 300), bottom_margin = 5mm, left_margin = 5mm,
    tickfont = font(12), guidefont = font(12), legendfont = font(12),
    xlabel = &quot;Prediction lag&quot;, ylabel = L&quot;\mathbb{A} (bits)&quot;,
    legend = :topleft)
plot!(1:Î·_max, influence_xtoy, m = :circle, c = :black, label = L&quot;x \to y&quot;)
plot!(1:Î·_max, influence_ytox,  m = :circle, c = :red, label = L&quot;y \to x&quot;)
hline!([0], ls = :dash, lc = :grey, label = &quot;&quot;)
</code></pre>

<p><img src="./CausalityTools_tutorial_PredictiveAsymmetryTest_32_0.png" alt="png" /></p>

<p>In this case, we find that the predictive asymmetry $\mathbb{A}$ is positive in both directions, and the asymmetry is greater in the direction $x \to y$, as expected. For more information about the predictive asymmetry approach, see the <a href="https://www.earthsystemevolution.com/publication/haaga_et_al_2020/" target="_blank">paper by Haaga <em>et al.</em></a></p>

<p>For more examples from <code>CausalityTools.jl</code>, see the package <a href="https://juliadynamics.github.io/CausalityTools.jl/dev/" target="_blank">documentation</a>.</p>

<h2 id="further-reading">Further reading</h2>

<p>Diego D, Haaga KA, Hannisdal B (2019). <em>Transfer entropy computation using the Perron-Frobenius operator.</em> Physical Review E 99.4: 042212. <a href="https://doi.org/10.1103/PhysRevE.99.042212" target="_blank">https://doi.org/10.1103/PhysRevE.99.042212</a></p>

<p>Haaga KA, Diego D, Brendryen J, Hannisdal B (2020). <em>A simple test for causality in complex systems</em>. <a href="https://arxiv.org/pdf/2005.01860.pdf" target="_blank">https://arxiv.org/pdf/2005.01860.pdf</a></p>

    </div>

    


    








  
  
    
  
  





  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="/authors/kristian-a.-haaga/"></a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
        
      </ul>
    </div>
  </div>




    
    

    
    
    

    
    
    

    
    
    

  </div>
</article>



<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/julia.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.15494b02d66be9b96bab2e305f69c460.js"></script>

  </body>
</html>

